# Spark Clima â˜€ï¸

Widget minimalista de previsÃ£o do tempo para KDE Plasma 6 usando dados brasileiros da API CPTEC/INPE atravÃ©s da BrasilAPI.

![KDE Plasma 6](https://img.shields.io/badge/KDE-Plasma%206-1d99f3?style=flat-square&logo=kde)
![.NET 10.0](https://img.shields.io/badge/.NET-10.0-512BD4?style=flat-square&logo=dotnet)
![License GPL-2.0+](https://img.shields.io/badge/License-GPL--2.0+-green?style=flat-square)

## ğŸ“‹ Sobre

Spark Clima Ã© um widget minimalista para KDE Plasma 6 que exibe a previsÃ£o do tempo de cidades brasileiras. Apresenta design moderno com fundo totalmente transparente, Ã­cones adaptativos (dia/noite) e cores que se ajustam automaticamente ao tema do sistema. O backend em C# consome a BrasilAPI e roda como serviÃ§o do usuÃ¡rio via systemd.

## âœ¨ CaracterÃ­sticas

- **Design Ultra Minimalista**: Apenas temperatura e Ã­cone no painel (70x30px)
- **Fundo Transparente**: IntegraÃ§Ã£o perfeita com painÃ©is flutuantes
- **Ãcones DinÃ¢micos**: AdaptaÃ§Ã£o automÃ¡tica entre Ã­cones diurnos e noturnos
- **Tema Adaptativo**: Cores ajustam-se ao tema claro/escuro do Plasma
- **AtualizaÃ§Ã£o AutomÃ¡tica**: Dados atualizados a cada 10 minutos (configurÃ¡vel)
- **Backend como ServiÃ§o**: Inicia automaticamente com o sistema
- **InstalaÃ§Ã£o Automatizada**: Scripts bash para instalar, atualizar e remover
- **Dados Brasileiros**: API oficial do CPTEC/INPE via BrasilAPI

## ğŸ–¼ï¸ Preview

### No Painel (Compacto)
- Apenas temperatura + Ã­cone (ex: "27Â° â˜€ï¸")
- Otimizado para painÃ©is de 30px de altura
- Fundo totalmente transparente

### Popup (Expandido)
Clique no widget para expandir:
- Cidade e estado
- Temperatura em destaque (64pt)
- Ãcone grande do clima
- Data da Ãºltima atualizaÃ§Ã£o
- BotÃ£o de atualizar

## ğŸ› ï¸ Tecnologias

### Backend
- C# / ASP.NET Core 10.0
- API BrasilAPI (CPTEC v1)
- JSON Source Generation (AOT friendly)
- Self-contained deployment
- Systemd user service

### Frontend
- QML (Qt Quick 6)
- KDE Plasma 6 Components
- Kirigami Framework
- Theme-aware colors

## ğŸ“¦ Estrutura do Projeto

```
clima-tempo/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Program.cs
â”‚   â”œâ”€â”€ appsettings.json
â”‚   â””â”€â”€ appsettings.Development.json
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ metadata.json
â”‚   â””â”€â”€ contents/
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â”œâ”€â”€ config.qml
â”‚       â”‚   â””â”€â”€ main.xml
â”‚       â””â”€â”€ ui/
â”‚           â”œâ”€â”€ main.qml
â”‚           â””â”€â”€ configGeneral.qml
â”œâ”€â”€ install.sh
â”œâ”€â”€ update.sh
â””â”€â”€ uninstall.sh
```

## ğŸš€ InstalaÃ§Ã£o RÃ¡pida

### Requisitos

- **Sistema**: Linux com KDE Plasma 6
- **.NET SDK**: 10.0 (apenas para compilar)
- **Ferramentas**: kpackagetool6, systemctl

```bash
# Arch Linux / Manjaro
sudo pacman -S dotnet-sdk plasma-sdk

# Ubuntu / Debian
sudo apt install dotnet-sdk-10.0 plasma-workspace-dev

# Fedora
sudo dnf install dotnet-sdk-10.0 plasma-workspace-devel
```

### InstalaÃ§Ã£o AutomÃ¡tica

```bash
# Clone o repositÃ³rio
git clone https://github.com/tlsilva89/spark-clima.git
cd spark-clima

# Torne os scripts executÃ¡veis
chmod +x install.sh update.sh uninstall.sh

# Execute a instalaÃ§Ã£o
./install.sh
```

O script irÃ¡:
1. Compilar o backend (self-contained, ~90MB)
2. Instalar em `~/.services/spark-clima/`
3. Criar serviÃ§o systemd do usuÃ¡rio
4. Habilitar inicializaÃ§Ã£o automÃ¡tica
5. Instalar o widget do Plasma

### Adicionar ao Painel

1. Clique direito no painel â†’ **Adicionar Widgets**
2. Procure por "Spark Clima"
3. Arraste para o painel

## âš™ï¸ ConfiguraÃ§Ã£o

### Alterar Cidade

Clique direito no widget â†’ **Configurar Spark Clima**

- **Cidade**: Nome da cidade (ex: Porto Alegre, SÃ£o Paulo)
- **Intervalo de AtualizaÃ§Ã£o**: 5 a 120 minutos (padrÃ£o: 10)

### Gerenciar Backend

```bash
# Ver status
systemctl --user status sparkclima

# Ver logs em tempo real
journalctl --user -u sparkclima -f

# Parar/Iniciar/Reiniciar
systemctl --user stop sparkclima
systemctl --user start sparkclima
systemctl --user restart sparkclima

# Testar API diretamente
curl "http://localhost:5234/clima?busca=Sao%20Paulo"
```

## ğŸ”„ AtualizaÃ§Ã£o

```bash
cd spark-clima
git pull
./update.sh
```

O script:
1. Para o backend
2. Compila nova versÃ£o
3. Faz backup da versÃ£o anterior
4. Atualiza widget
5. Reinicia o backend

## ğŸ—‘ï¸ DesinstalaÃ§Ã£o

```bash
./uninstall.sh
```

Remove:
- Widget do Plasma
- ServiÃ§o systemd
- Backend (`~/.services/spark-clima/`)
- Oferece remover backups antigos

## ğŸ“¡ API Backend

### GET /clima?busca={cidade}

**ParÃ¢metros:**
- `busca`: Nome da cidade ou ID CPTEC

**Resposta (200 OK):**

```json
{
  "cidade": "Porto Alegre",
  "estado": "RS",
  "temperatura": 27,
  "temperatura_min": 21,
  "temperatura_max": 34,
  "condicao": "Parcialmente Nublado",
  "condicao_code": "pn",
  "atualizado": "2025-12-28"
}
```

**Erro (404):**

```json
{
  "erro": "Cidade nao encontrada ou dados indisponiveis"
}
```

## ğŸ¨ CÃ³digos de CondiÃ§Ã£o ClimÃ¡tica

| CÃ³digo | CondiÃ§Ã£o | Ãcone Dia | Ãcone Noite |
|--------|----------|-----------|-------------|
| ec, c | CÃ©u Claro | â˜€ï¸ | ğŸŒ™ |
| pn, pc | Parcialmente Nublado | â›… | â˜ï¸ğŸŒ™ |
| n, cm, nv | Nublado | â˜ï¸ | â˜ï¸ |
| pp, pm, ch | Chuva | ğŸŒ§ï¸ | ğŸŒ§ï¸ |
| t, pt | Tempestade | â›ˆï¸ | â›ˆï¸ |
| s, e | Neve | â„ï¸ | â„ï¸ |
| g | Granizo | ğŸ§Š | ğŸ§Š |
| v | Neblina | ğŸŒ«ï¸ | ğŸŒ«ï¸ |

## ğŸ› ResoluÃ§Ã£o de Problemas

### Backend nÃ£o inicia

```bash
# Verificar porta
ss -tulpn | grep 5234

# Matar processo na porta
killall -9 ClimatempoBackend

# Ver logs de erro
journalctl --user -u sparkclima -n 50

# Testar manualmente
~/.services/spark-clima/ClimatempoBackend
```

### Widget mostra "Falha na conexÃ£o"

```bash
# Backend estÃ¡ rodando?
systemctl --user status sparkclima

# Testar API
curl "http://localhost:5234/clima?busca=Sao%20Paulo"

# Reiniciar Plasma
killall plasmashell && kstart5 plasmashell &
```

### Widget nÃ£o aparece na lista

```bash
# Reinstalar widget
kpackagetool6 -r dev.digitalspark.sparkclima
kpackagetool6 -i frontend

# Reiniciar Plasma
killall plasmashell && kstart5 plasmashell &
```

### Erro "Cidade nÃ£o encontrada"

- Verifique a grafia (use acentos: "SÃ£o Paulo" nÃ£o "Sao Paulo")
- Teste: `curl "http://localhost:5234/clima?busca=Porto%20Alegre"`
- Veja cidades disponÃ­veis: [BrasilAPI CPTEC Cidades](https://brasilapi.com.br/docs#tag/CPTEC)

## ğŸ—ï¸ Desenvolvimento

### Rodar Backend em Modo Dev

```bash
cd backend
dotnet watch run
```

### Testar Widget sem Instalar

```bash
# No painel horizontal
plasmoidviewer -a frontend -l topedge -f horizontal

# No desktop
plasmoidviewer -a frontend
```

### Compilar Backend para ProduÃ§Ã£o

```bash
cd backend
dotnet publish -c Release -r linux-x64 --self-contained true \
  /p:PublishSingleFile=true -o ./publish
```

## ğŸ“‚ LocalizaÃ§Ã£o dos Arquivos

```
~/.services/spark-clima/          # Backend instalado
~/.config/systemd/user/           # ServiÃ§o sparkclima.service
~/.local/share/plasma/plasmoids/  # Widget instalado
```

## ğŸ“ LicenÃ§a

GPL-2.0+ - Software Livre

## ğŸ‘¤ Autor

**Thiago Luciano**

- Email: tlsilva89@icloud.com
- Website: [https://digitalspark.dev](https://digitalspark.dev)
- GitHub: [@tlsilva89](https://github.com/tlsilva89)

## ğŸ™ CrÃ©ditos

- **BrasilAPI** - Wrapper da API CPTEC/INPE
- **CPTEC/INPE** - Dados meteorolÃ³gicos
- **KDE Project** - Framework Plasma 6

## ğŸ¤ Contribuindo

Pull requests sÃ£o bem-vindos!

1. Fork o projeto
2. Crie uma branch (`git checkout -b feature/NovaFeature`)
3. Commit (`git commit -m 'Adiciona NovaFeature'`)
4. Push (`git push origin feature/NovaFeature`)
5. Abra um Pull Request

---

â­ Gostou? DÃª uma estrela no repositÃ³rio!