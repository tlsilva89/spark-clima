# Spark Clima â˜€ï¸

Widget de previsÃ£o do tempo para KDE Plasma usando dados brasileiros da API CPTEC/INPE atravÃ©s da BrasilAPI.

![KDE Plasma 6](https://img.shields.io/badge/KDE-Plasma%206-1d99f3?style=flat-square&logo=kde)
![.NET 10.0](https://img.shields.io/badge/.NET-10.0-512BD4?style=flat-square&logo=dotnet)
![License GPL-2.0+](https://img.shields.io/badge/License-GPL--2.0+-green?style=flat-square)

## ğŸ“‹ Sobre

Spark Clima Ã© um widget minimalista para KDE Plasma que exibe a previsÃ£o do tempo de cidades brasileiras com design moderno e interface clean. O projeto utiliza um backend em C# que consome a BrasilAPI e um frontend em QML otimizado para Plasma 6.

## âœ¨ CaracterÃ­sticas

- **Design Minimalista**: Interface limpa com fundo transparente
- **Ãcones DinÃ¢micos**: AdaptaÃ§Ã£o automÃ¡tica entre Ã­cones diurnos e noturnos baseado no horÃ¡rio local
- **AtualizaÃ§Ã£o AutomÃ¡tica**: Dados atualizados a cada 10 minutos
- **ConfigurÃ¡vel**: Escolha sua cidade atravÃ©s do painel de configuraÃ§Ãµes
- **Leve e RÃ¡pido**: Backend otimizado com cache local
- **Dados Brasileiros**: Utiliza API oficial do CPTEC/INPE

## ğŸ–¼ï¸ Preview

- **RepresentaÃ§Ã£o Compacta**: Ãcone de clima + temperatura em formato pequeno (120x70px)
- **RepresentaÃ§Ã£o Expandida**: Vista completa com cidade, temperatura grande, Ã­cone climÃ¡tico e Ãºltima atualizaÃ§Ã£o (280x320px)

## ğŸ› ï¸ Tecnologias

### Backend
- C# / ASP.NET Core 10.0
- API BrasilAPI (CPTEC v1)
- CORS habilitado
- HttpClient Factory

### Frontend
- QML (Qt Quick)
- KDE Plasma 6 Components
- Kirigami Framework
- Plasma Widget API

## ğŸ“¦ Estrutura do Projeto

```
clima-tempo/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Program.cs
â”‚   â”œâ”€â”€ ClimatempoBackend.csproj
â”‚   â”œâ”€â”€ ClimatempoBackend.sln
â”‚   â”œâ”€â”€ appsettings.json
â”‚   â””â”€â”€ appsettings.Development.json
â””â”€â”€ frontend/
    â”œâ”€â”€ metadata.json
    â””â”€â”€ contents/
        â”œâ”€â”€ config/
        â”‚   â”œâ”€â”€ config.qml
        â”‚   â””â”€â”€ main.xml
        â””â”€â”€ ui/
            â”œâ”€â”€ main.qml
            â””â”€â”€ configGeneral.qml
```

## ğŸš€ InstalaÃ§Ã£o

### Requisitos

- **Sistema Operacional**: Linux com KDE Plasma 6
- **.NET SDK**: 10.0 ou superior
- **Plasma SDK**: plasma-sdk instalado

### Instalando DependÃªncias

```bash
# Arch Linux / Manjaro
sudo pacman -S dotnet-sdk plasma-sdk

# Ubuntu / Debian
sudo apt install dotnet-sdk-10.0 plasma-sdk

# Fedora
sudo dnf install dotnet-sdk-10.0 plasma-sdk
```

### Backend

```bash
cd backend
dotnet restore
dotnet run
```

O backend estarÃ¡ disponÃ­vel em `http://localhost:5234`

### Frontend (Widget)

```bash
cd frontend
kpackagetool6 -i . -t Plasma/Applet
```

Para atualizar o widget:

```bash
kpackagetool6 -u . -t Plasma/Applet
```

Para desinstalar:

```bash
kpackagetool6 -r dev.digitalspark.sparkclima
```

## ğŸ§ª Testando o Widget

Para testar o widget sem instalÃ¡-lo:

```bash
# Desktop widget
plasmoidviewer -a /caminho/para/frontend

# Widget no painel (horizontal)
plasmoidviewer -a /caminho/para/frontend -l topedge -f horizontal

# Widget no painel (vertical)
plasmoidviewer -a /caminho/para/frontend -l leftedge -f vertical
```

## âš™ï¸ ConfiguraÃ§Ã£o

### Alterando a Cidade PadrÃ£o

Clique com botÃ£o direito no widget â†’ **Configurar Spark Clima** â†’ Aba **Geral**

OpÃ§Ãµes disponÃ­veis:
- **Cidade**: Nome da cidade brasileira (ex: SÃ£o Paulo, Rio de Janeiro)
- **Atualizar a cada**: Intervalo de atualizaÃ§Ã£o em minutos (padrÃ£o: 10 min)

### Backend como ServiÃ§o Systemd

Crie o arquivo `/etc/systemd/system/sparkclima-backend.service`:

```ini
[Unit]
Description=Spark Clima Backend API
After=network.target

[Service]
Type=notify
User=seu-usuario
WorkingDirectory=/caminho/para/backend
ExecStart=/usr/bin/dotnet run --urls "http://localhost:5234"
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

Habilite o serviÃ§o:

```bash
sudo systemctl daemon-reload
sudo systemctl enable sparkclima-backend.service
sudo systemctl start sparkclima-backend.service
```

## ğŸ“¡ API Endpoints

### GET /clima?busca={cidade}

Retorna dados climÃ¡ticos da cidade especificada.

**ParÃ¢metros:**
- `busca`: Nome da cidade ou ID numÃ©rico do CPTEC

**Resposta de Sucesso (200):**

```json
{
  "cidade": "SÃ£o JosÃ© dos Campos",
  "estado": "SP",
  "temperatura": 27,
  "temperatura_min": 21,
  "temperatura_max": 34,
  "condicao": "Parcialmente Nublado",
  "condicao_code": "pn",
  "atualizado": "2025-12-28"
}
```

**Resposta de Erro (404):**

```json
{
  "erro": "Cidade nao encontrada ou dados indisponiveis"
}
```

## ğŸ¨ PersonalizaÃ§Ã£o

### Alterando Cores

Edite `frontend/contents/ui/main.qml` nas seÃ§Ãµes de `PlasmaComponents.Label`:

```qml
color: "#FFFFFF"  // Cor do texto
opacity: 0.7      // TransparÃªncia
```

### Modificando Tamanhos

```qml
font.pointSize: 64              // Tamanho da fonte
Layout.preferredWidth: 280      // Largura
Layout.preferredHeight: 320     // Altura
```

## ğŸ› ResoluÃ§Ã£o de Problemas

### Backend nÃ£o inicia

- Verifique se a porta 5234 estÃ¡ disponÃ­vel: `netstat -tlnp | grep 5234`
- Confirme se o .NET 10.0 estÃ¡ instalado: `dotnet --version`

### Widget nÃ£o aparece

- Reinstale: `kpackagetool6 -u frontend -t Plasma/Applet`
- Verifique logs: `journalctl -f | grep plasmashell`

### Erro "Cidade nÃ£o encontrada"

- Confirme a grafia correta da cidade
- Teste o endpoint diretamente: `curl "http://localhost:5234/clima?busca=Sao%20Paulo"`

### Ãcones nÃ£o aparecem

- Verifique se o tema de Ã­cones Breeze estÃ¡ instalado
- Instale: `sudo pacman -S breeze-icons` (Arch) ou `sudo apt install breeze-icon-theme` (Ubuntu)

## ğŸ“ LicenÃ§a

GPL-2.0+ - Veja o arquivo LICENSE para detalhes.

## ğŸ‘¤ Autor

**Thiago Luciano**

- Email: tlsilva89@icloud.com
- Website: [https://digitalspark.dev](https://digitalspark.dev)
- GitHub: [@tlsilva89](https://github.com/tlsilva89)

## ğŸ™ CrÃ©ditos

- **BrasilAPI**: Dados meteorolÃ³gicos do CPTEC/INPE
- **KDE Project**: Framework Plasma e Kirigami
- **CPTEC/INPE**: Centro de PrevisÃ£o de Tempo e Estudos ClimÃ¡ticos

## ğŸ¤ Contribuindo

ContribuiÃ§Ãµes sÃ£o bem-vindas! Sinta-se livre para:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Adiciona MinhaFeature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

---

â­ Se este projeto foi Ãºtil para vocÃª, considere dar uma estrela no repositÃ³rio!